!function(e,t){"object"==typeof exports&&"undefined"!=typeof module?module.exports=t():"function"==typeof define&&define.amd?define(t):e.heyModal=t()}(this,function(){"use strict";function e(t){for(var i,s,n=Array.prototype.slice.call(arguments,1);n.length;){i=n.shift();for(s in i)i.hasOwnProperty(s)&&("object"==typeof t[s]&&t[s]&&"[object Array]"!==Object.prototype.toString.call(t[s])&&"object"==typeof i[s]&&null!==i[s]?t[s]=e({},t[s],i[s]):t[s]=i[s])}return t}function t(e){if(Array.isArray(e)){for(var t=0,i=Array(e.length);t<e.length;t++)i[t]=e[t];return i}return Array.from(e)}function i(e,t){var i=arguments.length>2&&void 0!==arguments[2]?arguments[2]:this,s=null,n=null,o=function(){return e.apply(i,n)};return function(){for(var e=arguments.length,i=Array(e),a=0;a<e;a++)i[a]=arguments[a];n=i,clearTimeout(s),s=setTimeout(o,t)}}try{var s=new window.CustomEvent("test");if(s.preventDefault(),!0!==s.defaultPrevented)throw new Error("Could not prevent default")}catch(e){var n=function(e,t){var i,s;return t=t||{bubbles:!1,cancelable:!1,detail:void 0},i=document.createEvent("CustomEvent"),i.initCustomEvent(e,t.bubbles,t.cancelable,t.detail),s=i.preventDefault,i.preventDefault=function(){s.call(this);try{Object.defineProperty(this,"defaultPrevented",{get:function(){return!0}})}catch(e){this.defaultPrevented=!0}},i};n.prototype=window.Event.prototype,window.CustomEvent=n}var o=e;return function(){var e=0,s={classes:{modal:["modal"],modalDialog:["modal__dialog"],modalHeader:["modal__header"],modalBody:["modal__body"],modalContent:["modal__content"],modalClose:["modal__close"],modalCloseBtnText:["modal__close-text"],modalTitle:["modal__title"],confirm:["modal__confirm"],confirmYes:["btn","btn--positive"],confirmCancel:["btn","btn--negative"],visibleClass:["modal--is-visible"],bodyOverflowClass:["modal-body-no-scroll"]}},n={options:s,body:null,elem:null,onClick:null,target:null,confirm:!1,events:{open:new CustomEvent("heyOpen"),close:new CustomEvent("heyClose")},content:{title:null,body:null},shared:{isScrollable:null,scrollbarWidth:null,testResults:null},init:function(){this.body=document.querySelector("body"),this.id=e,this.tests(),this.setScrollable(),this.setScrollbarWidth(),this.checkClasses(),this.elem.hasAttribute("data-hey-confirm")&&(this.confirm=!0),this.confirm||(this.setTarget(),this.checkTarget()),this.build(),this.removeTarget(),this.shared.testResults.flexbox||this.setMaxHeight(),this.bindEvents()},tests:function(){if(!this.shared.testResults){var e={};e.transitions="transition"in document.documentElement.style||"WebkitTransition"in document.documentElement.style,e.flexbox="flex-wrap"in document.documentElement.style,this.shared.testResults=e}},on:function(e,t){this.comp.wrapper.addEventListener(e,t)},checkClasses:function(){var e=this;try{if(!Object.keys(this.options.classes).every(function(t){return e.options.classes[t]instanceof Array}))throw new Error("Classes must be set as arrays, e.g. confirm: ['class-one']")}catch(e){console.error(e)}},build:function(){var e,i,s,n,o,a,r,l,c=this,d={},h=this.options.classes;if(d.wrapper=document.createElement("div"),(e=d.wrapper.classList).add.apply(e,t(h.modal)),d.wrapper.setAttribute("aria-hidden","true"),d.dialog=document.createElement("div"),(i=d.dialog.classList).add.apply(i,t(h.modalDialog)),d.dialog.setAttribute("role","dialog"),d.dialog.setAttribute("aria-labelledby","modal__title-"+this.id),d.header=document.createElement("div"),(s=d.header.classList).add.apply(s,t(h.modalHeader)),d.title=document.createElement("h3"),(n=d.title.classList).add.apply(n,t(h.modalTitle)),d.title.id="modal__title-"+this.id,d.inner=document.createElement("div"),(o=d.inner.classList).add.apply(o,t(h.modalBody)),d.inner.style.overflow="auto",d.body=document.createElement("div"),(a=d.body.classList).add.apply(a,t(h.modalContent)),d.inner.appendChild(d.body),d.closeBtn=document.createElement("button"),(r=d.closeBtn.classList).add.apply(r,t(h.modalClose)),d.closeBtn.setAttribute("type","button"),d.closeBtn.setAttribute("aria-label","Close"),d.closeText=document.createElement("span"),(l=d.closeText.classList).add.apply(l,t(h.modalCloseBtnText)),d.closeText.innerHTML="Close",d.closeBtn.appendChild(d.closeText),this.confirm){var p,u,m;d.confirm=document.createElement("div"),(p=d.confirm.classList).add.apply(p,t(h.confirm)),d.confirmYes=document.createElement("a"),d.confirmYes.innerHTML="Proceed",(u=d.confirmYes.classList).add.apply(u,t(h.confirmYes)),"A"===this.elem.nodeName?d.confirmYes.setAttribute("href",this.elem.getAttribute("href")):(d.confirmYes.addEventListener("click",function(e){e.preventDefault(),c.elem.removeEventListener("click",c.onClick),c.elem.click(),c.elem.addEventListener("click",c.onClick),c.close()}),d.confirmYes.setAttribute("href","#")),d.confirmCancel=document.createElement("button"),d.confirmCancel.innerHTML="Cancel",d.confirmCancel.setAttribute("data-hey-close",""),(m=d.confirmCancel.classList).add.apply(m,t(h.confirmCancel)),d.confirm.appendChild(d.confirmYes),d.confirm.appendChild(d.confirmCancel),d.inner.appendChild(d.confirm)}d.header.appendChild(d.title),d.header.appendChild(d.closeBtn),d.dialog.appendChild(d.header),d.dialog.appendChild(d.inner),d.wrapper.appendChild(d.dialog),this.comp=d,this.populate(),this.body.appendChild(d.wrapper)},populate:function(){var e=this,t={};for(var i in this.content){if(t[i]=this.content[i],!this.content[i])if(e.target){var s=e.target.querySelector("[data-hey-"+i+"]");s&&(t[i]=s.innerHTML)}else e.elem.hasAttribute("data-hey-"+i)&&(t[i]=e.elem.getAttribute("data-hey-"+i));this.comp[i].innerHTML=t[i]}this.content=t},setMaxHeight:function(){var e=getComputedStyle(this.comp.wrapper),t=this.comp.header.offsetHeight,i=this.comp.wrapper.offsetHeight;this.comp.inner.style.maxHeight="calc("+i+"px - ("+e.paddingTop+" + "+e.paddingTop+") - "+t+"px)"},setTarget:function(){this.elem.hasAttribute("data-hey")?this.target=document.querySelector(this.elem.getAttribute("data-hey")):this.elem.hasAttribute("href")&&this.elem.getAttribute("href").indexOf("#")>=0&&(this.target=document.querySelector(this.elem.getAttribute("href")))},checkTarget:function(){var e=void 0;try{if(!this.target||!this.target.nodeType)throw e=!1,new Error("No modal target given.");e=!0}catch(e){console.error(e)}return e},removeTarget:function(){this.target&&this.target.parentElement.removeChild(this.target)},bindEvents:function(){var e=this;window.addEventListener("resize",i(this.setScrollable.bind(this),500)),this.shared.testResults.flexbox||window.addEventListener("resize",i(this.setMaxHeight.bind(this),200)),this.comp.wrapper.addEventListener("touchmove",function(e){e.preventDefault()},!1),this.comp.body.addEventListener("touchmove",function(e){e.stopPropagation()},!1),this.onClick=function(t){t.preventDefault(),e.open()},this.elem.addEventListener("click",this.onClick),this.comp.closeBtn.addEventListener("click",this.close.bind(this)),this.comp.wrapper.addEventListener("click",function(t){t.target.classList.contains(e.options.classes.modal.join(" "))&&e.close()});var t=this.comp.dialog.querySelector("[data-hey-close]");t&&t.addEventListener("click",function(t){t.preventDefault(),e.close()}),this.comp.wrapper.addEventListener("keydown",function(t){switch(t.keyCode){case 27:e.close();break;case 9:t.shiftKey?e.firstFocusable===document.activeElement&&(t.preventDefault(),e.lastFocusable.focus()):e.lastFocusable===document.activeElement&&(t.preventDefault(),e.firstFocusable.focus())}})},setScrollable:function(){var e=document.body.offsetHeight>window.innerHeight,t=document.documentElement.clientWidth===window.innerWidth;this.shared.isScrollable=e&&!t},open:function(){function e(){this.setFocus(),this.comp.wrapper.removeEventListener("transitionEnd",e)}var i;(i=this.comp.wrapper.classList).add.apply(i,t(this.options.classes.visibleClass)),this.setPageScroll(!1),this.comp.wrapper.setAttribute("aria-hidden","false"),this.setLastFocusedElem(),this.comp.wrapper.dispatchEvent(this.events.open),this.body.style.marginRight=this.shared.isScrollable?this.shared.scrollbarWidth+"px":"",this.shared.testResults.transitions&&this.comp.wrapper.addEventListener("transitionend",e.bind(this))},setFocus:function(){var e=this.comp.dialog.querySelectorAll('a[href], area[href], input:not([disabled]), select:not([disabled]), textarea:not([disabled]), button:not([disabled]), [tabindex="0"]');this.firstFocusable=e[0],this.lastFocusable=e[e.length-1],this.firstFocusable.focus()},setLastFocusedElem:function(){this.lastFocused=document.activeElement},close:function(){var e,i=this;(e=this.comp.wrapper.classList).remove.apply(e,t(this.options.classes.visibleClass)),this.lastFocused.focus();var s=function e(){i.setPageScroll(!0),i.body.style.marginRight=0,i.comp.wrapper.removeEventListener("transitionend",e),i.comp.wrapper.setAttribute("aria-hidden","true"),i.comp.wrapper.dispatchEvent(i.events.close)};this.shared.testResults.transitions?this.comp.wrapper.addEventListener("transitionend",s):s()},setPageScroll:function(){if(arguments.length>0&&void 0!==arguments[0]&&arguments[0]){var e;(e=this.body.classList).remove.apply(e,t(this.options.classes.bodyOverflowClass))}else{var i;(i=this.body.classList).add.apply(i,t(this.options.classes.bodyOverflowClass))}},setScrollbarWidth:function(){if(!this.shared.scrollbarWidth){var e=document.createElement("div");e.style.width=100,e.style.height=100,e.style.overflow="scroll",e.style.position="absolute",e.style.top=-9999,this.body.appendChild(e);var t=e.offsetWidth-e.clientWidth;this.body.removeChild(e),this.shared.scrollbarWidth=t}}};return function(t,i){e+=1;var a=o({},s,i),r=o(Object.create(n),{elem:t},{options:a});return r.init(),r}}()});
